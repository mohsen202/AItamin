<script type="module">
    import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client@latest/dist/index.min.js";

    const client = await Client.connect("https://9492e2709df9122068.gradio.live/");

    const chatContainer = document.getElementById('chat-container');
    const inputText = document.getElementById('input-text');
    const sendButton = document.getElementById('send-button');
    const loadingContainer = document.getElementById('loading-container');

    function addMessage(text, sender) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', sender);
        messageElement.textContent = text;
        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function sendMessage() {
        const userMessage = inputText.value.trim();
        if (!userMessage) return;

        addMessage(userMessage, 'user');
        inputText.value = '';

        loadingContainer.style.display = 'block';

        try {
            const result = await client.predict("/predict", { 
                input_text: userMessage, 
            });

            const botResponse = result.data[0];
            addMessage(botResponse, 'bot');
        } catch (error) {
            console.error("An error occurred:", error);
            addMessage("خطا رخ داد. سرور ران نیست! لطفا با ادمین تماس بگیرید", 'bot');
        } finally {
            loadingContainer.style.display = 'none';
        }
    }

    sendButton.addEventListener('click', sendMessage);
    inputText.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            sendMessage();
        }
    });
</script>
